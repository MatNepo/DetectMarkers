# Marker Detection Project

## Описание

Этот проект предназначен для работы с детекцией маркеров (Aruco, AprilTag, Stag) в видеопотоках и изображениях. Поддерживается работа с пользовательскими словарями, анализ точности, генерация отчетов и визуализация результатов.

## Структура проекта

- `detectors/` — основные детекторы и их вспомогательные файлы
  - `aruco/` — Aruco-детектор, словари, параметры
  - `apriltag/` — AprilTag-детектор, примеры
  - `stag/` — Stag-детектор
  - `base/` — базовые классы
- `utils/` — вспомогательные скрипты (запуск, обработка, анализ)
- `data/` — все данные, словари, отчеты, изображения, видео
  - `custom_dicts/` — пользовательские словари Aruco
  - `output_markers/` — изображения с результатами
  - `videos/` — видеофайлы
  - `reports/` — отчеты
  - `example_images/` — примеры изображений

## Что нужно заполнить перед запуском

Перед использованием проекта обязательно настройте следующие поля и файлы:

1. **Имена камер/локаций**
   - В файлах:
     - `detectors/aruco/ids_description.py`
     - `detectors/apriltag/ids_description.py`
     - `detectors/stag/ids_description.py`
     - `detectors/aruco/camera_description.py`
     - `utils/marker_distance.py`
   - Замените все ключи вида `camera_1`, `camera_2`, ... на свои реальные имена камер или локаций. Пример:
     ```python
     aruco_ids_by_camera = {
         'office': [0, 1, 2],
         'warehouse': [10, 11],
     }
     ```

2. **RTSP-ссылки и потоки**
   - В файлах:
     - `utils/distance_counter.py`
     - `detectors/apriltag/distance_counter.py`
   - Замените значения в словаре `cameras_ip_dict` на свои реальные RTSP-ссылки для каждой камеры. Пример:
     ```python
     cameras_ip_dict = {
         'office': 'rtsp://user:password@host:554/rtsp?channelid=YOUR_CHANNEL_ID',
         # ...
     }
     ```

3. **Пути к пользовательским словарям**
   - Проверьте, что ваши словари Aruco лежат в `data/custom_dicts/` и пути к ним в коде совпадают с реальным расположением файлов.

4. **Пути к видео и изображениям**
   - Для тестов и обработки укажите свои пути к видеофайлам и изображениям в скриптах, если используете свои данные.

5. **Поля для отчётов и результатов**
   - Проверьте, что папки для результатов (`data/reports/`, `data/output_markers/`) существуют и доступны для записи.

6. **DLL для pupil_apriltags**
   - Если используете AprilTag, укажите путь к DLL через `os.add_dll_directory()` в нужном скрипте, если требуется.

## Подробная инструкция по запуску

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Настройка проекта

- Заполните все необходимые поля, как указано выше.
- Проверьте структуру папок и наличие всех нужных файлов.

### 3. Сценарии запуска

#### A. Детекция маркеров на видео с камеры или файла

- **Aruco**:
  ```bash
  python utils/launch_video_streams.py
  ```
  - Следуйте инструкциям в консоли: выберите камеру (по имени из ваших словарей), укажите путь к видео или выберите RTSP-поток.

- **AprilTag**:
  ```bash
  python detectors/apriltag/example.py
  ```
  - Проверьте путь к изображению в файле и подставьте свой.

- **Stag**:
  ```bash
  python detectors/stag/detect_video.py
  ```
  - Проверьте путь к видео в файле и подставьте свой.

#### B. Сохранение видео с камеры

```bash
python utils/save_video_stream.py
```
- Следуйте инструкциям в консоли для выбора камеры и параметров записи.

#### C. Анализ точности и генерация отчётов

- **Анализ точности**:
  ```bash
  python utils/accuracy_detection.py
  ```
- **Генерация отчёта по расстояниям**:
  ```bash
  python utils/marker_distance.py
  ```

#### D. Преобразование изображений в PDF

```bash
python utils/imgs_to_pdf.py
```
- Укажите нужную папку с изображениями.

### 4. Использование своих данных

- Для работы с собственными видео, изображениями, словарями и RTSP-потоками — просто подставьте свои значения в соответствующие поля и словари, как описано выше.

## Примечания
- Все чувствительные данные и приватные пути удалены/заменены.
- Для работы с RTSP-камерами укажите свои данные в соответствующих местах.
- Для pupil_apriltags может потребоваться указать путь к DLL через `os.add_dll_directory()`.
- Если возникнут вопросы по настройке — смотрите комментарии в коде или обратитесь к этому README. 
